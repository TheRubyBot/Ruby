{
  "version": 3,
  "sources": ["../../src/core/bot.ts"],
  "sourcesContent": ["import { PrismaClient } from \"@prisma/client\";\nimport { Client } from \"discord.js\";\nimport { readFileSync } from \"fs\";\nimport { join } from \"path\";\nimport { ApplicationCommand } from \"./constructors/ApplicationCommandConstructor\";\nimport { TextCommand } from \"./constructors/TextCommandConstructor\";\nimport { ApplciationCommandHandler } from \"./handlers/ApplicationCommandHandler\";\nimport { readDir } from \"./util/readDir\";\n\ninterface IBotConfig {\n  commandsDir: string;\n  owners: string[];\n  testServers: string[];\n  prefixes: string[];\n  globalSlashTesting: boolean;\n}\n\nexport class Bot {\n  // Clients\n  public client: Client = new Client({\n    intents: [\"GUILDS\", \"GUILD_MESSAGES\", \"GUILD_MEMBERS\"]\n  });\n  public prisma: PrismaClient = new PrismaClient();\n\n  public version: { number: string; revision: number; codename: string };\n\n  // Discord Configs\n  public commandsDir = \"commands\";\n  public owners: string[] = [];\n  public testServers: string[] = [];\n  public prefixes: string[] = [];\n  public globalSlashTesting = false;\n\n  // Handlers\n  private $applicationCommandHandler: ApplciationCommandHandler | undefined;\n  // Private readonly $eventHandler: EventHandler;\n  // Private readonly $textCommandHandler: TextCommandHandler;\n\n  constructor(config: IBotConfig) {\n    const pjson = JSON.parse(readFileSync(\"./package.json\", \"utf8\"));\n    this.version = {\n      number: pjson.version,\n      revision: pjson.revision,\n      codename: pjson.codename\n    };\n\n    const { commandsDir, owners, prefixes, testServers, globalSlashTesting } = config;\n\n    this.commandsDir = commandsDir;\n    this.prefixes = prefixes;\n    this.globalSlashTesting = globalSlashTesting;\n\n    for (const owner of owners)\n      this.client.users.fetch(owner).catch(() => {\n        throw new Error(`Owner: ${owner} cannot be seen by bot`);\n      });\n    this.owners = owners;\n\n    for (const testServer of testServers)\n      this.client.guilds.fetch(testServer).catch(() => {\n        throw new Error(`Test server: ${testServer} cannot be seen by bot`);\n      });\n    this.testServers = testServers;\n\n    if (require.main) {\n      const { path } = require.main;\n\n      if (path) this.commandsDir = join(path, this.commandsDir);\n    }\n\n    this.client.on(\"ready\", () => {\n      console.log(`Logged in as ${this.client.user?.tag}`);\n\n      this.prefixes.push(`<@${this.client.user?.id}>`);\n      this.prefixes.push(`<@!${this.client.user?.id}>`);\n\n      const commandFiles = readDir(this.commandsDir, { ignoreDot: true }).filter((file) => file.endsWith(\".js\"));\n\n      const seperated = this.seperateCommands(commandFiles);\n\n      this.$applicationCommandHandler = seperated.applicationCommandHandler;\n    });\n  }\n\n  public login(token: string): void {\n    this.client.login(token);\n  }\n\n  private seperateCommands(commandFiles: string[]): { applicationCommandHandler: ApplciationCommandHandler } {\n    const applicationCommands: ApplicationCommand[] = [];\n    const textCommands: TextCommand[] = [];\n\n    for (const file of commandFiles) {\n      // eslint-disable-next-line @typescript-eslint/no-require-imports, @typescript-eslint/no-var-requires\n      let imported = require(file);\n\n      if (imported.command) imported = imported.command;\n      else if (imported.default) imported = imported.default;\n\n      if (imported.isSlash()) applicationCommands.push(imported);\n      else if (imported.isText()) textCommands.push(imported);\n    }\n\n    return {\n      applicationCommandHandler: new ApplciationCommandHandler(applicationCommands, this)\n    };\n  }\n}\n"],
  "mappings": "8gBAAA,gCAA6B,0BAC7B,EAAuB,sBACvB,EAA6B,cAC7B,EAAqB,gBAGrB,EAA0C,gDAC1C,EAAwB,0BAUjB,OAAU,CAqBf,YAAY,EAAoB,CAnBzB,YAAiB,GAAI,UAAO,CACjC,QAAS,CAAC,SAAU,iBAAkB,mBAEjC,YAAuB,GAAI,gBAK3B,iBAAc,WACd,YAAmB,GACnB,iBAAwB,GACxB,cAAqB,GACrB,wBAAqB,GAQ1B,KAAM,GAAQ,KAAK,MAAM,mBAAa,iBAAkB,SACxD,KAAK,QAAU,CACb,OAAQ,EAAM,QACd,SAAU,EAAM,SAChB,SAAU,EAAM,UAGlB,KAAM,CAAE,cAAa,SAAQ,WAAU,cAAa,sBAAuB,EAE3E,KAAK,YAAc,EACnB,KAAK,SAAW,EAChB,KAAK,mBAAqB,EAE1B,SAAW,KAAS,GAClB,KAAK,OAAO,MAAM,MAAM,GAAO,MAAM,IAAM,CACzC,KAAM,IAAI,OAAM,UAAU,6BAE9B,KAAK,OAAS,EAEd,SAAW,KAAc,GACvB,KAAK,OAAO,OAAO,MAAM,GAAY,MAAM,IAAM,CAC/C,KAAM,IAAI,OAAM,gBAAgB,6BAIpC,GAFA,KAAK,YAAc,EAEf,QAAQ,KAAM,CAChB,KAAM,CAAE,QAAS,QAAQ,KAEzB,AAAI,GAAM,MAAK,YAAc,WAAK,EAAM,KAAK,cAG/C,KAAK,OAAO,GAAG,QAAS,IAAM,CAtElC,UAuEM,QAAQ,IAAI,gBAAgB,QAAK,OAAO,OAAZ,cAAkB,OAE9C,KAAK,SAAS,KAAK,KAAK,QAAK,OAAO,OAAZ,cAAkB,OAC1C,KAAK,SAAS,KAAK,MAAM,QAAK,OAAO,OAAZ,cAAkB,OAE3C,KAAM,GAAe,cAAQ,KAAK,YAAa,CAAE,UAAW,KAAQ,OAAO,AAAC,GAAS,EAAK,SAAS,QAE7F,EAAY,KAAK,iBAAiB,GAExC,KAAK,2BAA6B,EAAU,4BAIzC,MAAM,EAAqB,CAChC,KAAK,OAAO,MAAM,GAGZ,iBAAiB,EAAkF,CACzG,KAAM,GAA4C,GAC5C,EAA8B,GAEpC,SAAW,KAAQ,GAAc,CAE/B,GAAI,GAAW,QAAQ,GAEvB,AAAI,EAAS,QAAS,EAAW,EAAS,QACjC,EAAS,SAAS,GAAW,EAAS,SAE/C,AAAI,EAAS,UAAW,EAAoB,KAAK,GACxC,EAAS,UAAU,EAAa,KAAK,GAGhD,MAAO,CACL,0BAA2B,GAAI,6BAA0B,EAAqB",
  "names": []
}
